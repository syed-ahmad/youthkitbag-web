<%- include('../../includes/head') %>

<%- include('../../includes/title', { 
    title: { title: wanted.title }, 
    breadcrumbs: [ { style: 'home', title: 'Home', url: '/' }, { title: 'Kitbag', url: '/kitbag/kit/all' }, { title: 'For sale', url: '/kitbag/wanted/all' }, { title: `Sell: ${wanted.title}` } ]
}) %>

<section id="main" class="container-fluid" aria-label="main body of content plus related links and features">
    <div class="container">

        <form class="pb-3" action="/kitbag/wanted/<% if (editing) { %>edit<% } else { %>add<% } %>" method="POST" enctype="multipart/form-data">

        <div class="row">
            <div class="col-12 col-lg-6 order-1 order-lg-2" role="main">
                <div>
                    <img id="preview" class="img-fluid mb-3" src="<%= wanted.images.length > 0 ? wanted.images[0].imageUrl : '/images/default.png' %>" alt="" role="presentation">
                </div>
                <% if (wanted.images && wanted.images.length > 1) { %>
                <div>
                    <% wanted.images.forEach(function(image, i) { %>
                        <img class="img-fluid mb-3 img-link" style="max-height: 90px;" src="<%= image.imageUrl %>" alt="" role="presentation" onclick="document.getElementById('preview').src='<%= image.imageUrl %>';">
                    <% }) %>
                </div>
                <% } %>
            </div>
            <div class="col-12 col-lg-6 order-2 order-lg-1" role="main">
                <div class="form-group row">
                    <label for="title" class="col-sm-3 col-form-label">Title</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control <%= errors.find(e => e.param === 'title') ? 'is-invalid' : '' %>" id="title" name="title" aria-describedby="title" value="<%= wanted.title %>" required="required" aria-required="true">
                        <div class="invalid-feedback"><%= errors.find(e => e.param === 'title') ? errors.find(e => e.param === 'title').msg : '' %></div>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="subtitle" class="col-sm-3 col-form-label">Subtitle (optional)</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="subtitle" name="subtitle" aria-describedby="subtitle" value="<%= wanted.subtitle %>">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label">Images</label>
                    <div class="col-sm-9">
                        <div class="custom-file">
                            <input type="file" multiple class="custom-file-input" id="images" name="photos" aria-describedby="images">
                            <label class="custom-file-label" for="images">Choose image(s)</label>
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="description" class="col-sm-3 col-form-label">Description</label>
                    <div class="col-sm-9">
                        <textarea class="form-control <%= errors.find(e => e.param === 'description') ? 'is-invalid' : '' %>" id="description" rows="5" name="description"><%= wanted.description %></textarea>
                        <div class="invalid-feedback"><%= errors.find(e => e.param === 'description') ? errors.find(e => e.param === 'description').msg : '' %></div>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="condition" class="col-sm-3 col-form-label">Condition</label>
                    <div class="col-sm-9">
                        <select class="custom-select" id="condition" name="condition">
                            <option value="used" <%= wanted.condition == 'used' ? 'selected' : '' %>>Used</option>
                            <option value="new" <%= wanted.condition == 'new' ? 'selected' : '' %>>New</option>
                            <option value="almostnew" <%= wanted.condition == 'almostnew' ? 'selected' : '' %>>Almost New</option>
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="offerPrice" class="col-sm-3 col-form-label">Offer Price</label>
                    <div class="col-sm-9">
                        <input type="number" class="form-control" id="offerPrice" name="offerPrice" step=".01" aria-describedby="offerPrice" value="<%= Number(wanted.offerPrice).toFixed(2) %>">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="activitys" class="col-sm-3 col-form-label">Activities</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="activitys" name="activitys" aria-describedby="activitys" value="<% if (wanted.activitys) { %><%= wanted.activitys.join(', ') %><% }%>">
                    </div>
                </div>
                <div class="form-group row mb-0">
                    <label class="col-sm-3" for="obtained">Obtained</label>
                    <div class="col-1 col-sm-1">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="obtained" name="obtained" <%= wanted.obtained ? 'checked' : '' %> >
                        </div>
                    </div>
                    <div class="col-10 col-sm-8">
                        <div class="form-check">
                            <small id="activehelp" class="form-text text-muted form-control-help">Please remember to update this item when you have bought/received it.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr />
        <div class="row pb-3">
            <div class="col-12 col-lg-6" role="main">
                    <% if (editing) { %>
                        <input type="hidden" name="wantedId" value="<%= wanted._id %>">
                    <% } %>
                    <input type="hidden" name="origImages" value="<%= origImages %>">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <input type="hidden" name="sourceId" value="<%= wanted.sourceId %>">
                    <button class="btn btn-primary" type="submit"><% if (editing) { %>Update Wanted Item<% } else { %>Add Item to Wanted<% } %></button>
                </form>
                <form action="/kitbag/wanted/delete" method="POST" class="d-inline">
                    <input type="hidden" name="wantedId" value="<%= wanted._id %>">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button class="btn btn-secondary" type="submit">Delete</button>
                </form>
            </div>
        </div>
    </div>
</section>

<%- include('../../includes/foot') %>