<%- include('../../includes/head') %>

<%- include('../../includes/title', { 
    title: { title: pageTitle }, 
    breadcrumbs: [ { style: 'home', title: 'Home', url: '/' }, { title: 'Kitbag', url: '/kitbag/kit/all' }, { title: pageTitle } ]
}) %>

<section id="main" class="container-fluid" aria-label="main body of content plus related links and features">
    <div class="container">

        <div class="row">
            <div class="col-12 col-sm-9">
                <div class="d-inline-block">
                    <form action="/kitbag/kit/all" method="GET">
                        <div class="form-group mr-3">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <select class="custom-select" id="by" name="by">
                                        <option value="all" <%= by == 'all' ? 'selected' : '' %> >All</option>
                                        <option value="title" <%= by == 'title' ? 'selected' : '' %> >Title</option>
                                        <option value="activity" <%= by == 'activity' ? 'selected' : '' %> >Activity</option>
                                        <option value="tag" <%= by == 'tag' ? 'selected' : '' %> >Tag</option>
                                        <option value="inactive" <%= by == 'inactive' ? 'selected' : '' %> >All Inactive</option>
                                    </select>
                                </div>
                                <input type="text" class="form-control" aria-label="Search by text" id="search" name="search" value="<%= search %>">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-primary" type="submit" id="search">Search</button>
                                    <a href="/kitbag/kit/all" class="btn btn-outline-secondary">Clear</a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-12 col-sm-3 mb-3 d-flex justify-content-end">
                <a href="/kitbag/kit/add" class="btn btn-primary <% if (package.max.kit <= package.size.kit) { %>disabled<% } %>">Add new kit</a>
            </div>
        </div>

        <% if (kits.length > 0) { %>
            <div class="row">
                <% for (let kit of kits) { %>
                <div class="col-6 col-md-4 col-lg-3 mb-3">
                    <article class="card card-link card-b1">
                        <span class="badge badge-pill badge-dark badge-fullsize badge-top-right"><%= kit.inbag.reduce(function (x, y) { return x + y.quantity; }, 0) %></span>
                        <a href="/kitbag/kit/edit/<%= kit._id %>">
                        <img class="card-img-top" src="<%= kit.images.length > 0 ? kit.images[0].imageUrl : '/images/default.png' %>" alt="<%= kit.title %>" role="presentation">
                        <div class="card-body">
                            <h3 class="card-title h6 ellipsis"><%= kit.title %></h3>
                            <% if (kit.subtitle) { %>
                                <p class="card-text ellipsis"><%= kit.subtitle %></p>
                            <% } %>
                        </div>
                        </a>
                    </article>
                </div>
                <% } %>
            </div>
            <%- include('../../includes/pagination.ejs', pagination) %>
        <% } else { %>
            <div class="row">
                <div class="col-12 mb-3">
                    <h3>No kit found!</h3>
                </div>
            </div>
        <% } %>

    </div>
</section>

<%- include('../../includes/foot') %>
